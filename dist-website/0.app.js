(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{271:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.matrixClient=void 0;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r=function(e){return e&&e.__esModule?e:{default:e}}(n(376));var s=t.matrixClient={client:null,firstEvent:{},syncFailCount:0,paginate:function(e){var t=this,n=this.client.getRoom(e);if(!n)throw{errcode:"PAGINATE_NO_ROOM"};var i=n.getTimelineSets()[0];return this.client.getEventTimeline(i,this.firstEvent[e]).then(function(e){return t.client.paginateEventTimeline(e,{backwards:!0})})},login:function(e,t,n,s){var o=this;return new Promise(function(a){o.client=r.default.createClient(i({},e,{baseUrl:"https://matrix.org",timelineSupport:!0})),o.client.on("Room.timeline",function(e){var t=e.event.room_id,i=e.sender.userId,r=e.event.origin_server_ts;t in o.firstEvent||(o.firstEvent[t]=e.event.event_id);var s={roomId:t,sender:i,createdAt:r,eventId:e.event.event_id};if("audiusMedia"===e.event.type)n("parseMatrixMessage",Object.assign(e.event.content,s));else if("org.rockdapus.audius"===e.event.type)"media"===e.event.content.type&&n("parseMatrixMessage",Object.assign(e.event.content.data,s));else if("m.room.message"===e.event.type){var a=e.event.content.body;n("parseMatrixMessage",Object.assign({body:a,type:"text"},s))}}),o.client.on("sync",function(e,t,n){if("ERROR"===e){if(n)return s("error",""+n.error.data.error),"M_UNKNOWN_TOKEN"===n.error.data.errcode&&s("toggleMatrixLoginModal",!0),void o.stop();o.syncFailCount>=3?(s("error","Could not connect to matrix more than 3 time. Disconnecting."),o.stop()):(s("error","Could not connect to matrix server. "+(o.syncFailCount?"Attempt "+o.syncFailCount:"")),o.syncFailCount++)}else"SYNCING"===e?o.syncFailCount=0:"PREPARED"===e&&a(o.client.getRooms())}),(void 0===t||t)&&o.client.setGuest(!0),o.client.startClient({initialSyncLimit:20})})},register:function(e){var t=e.username,n=e.password,i=e.sessionId,r=e.auth,s=e.bindThreepids,o=e.guestAccessToken;return this.client.register(t,n,i,r,s,o)},stop:function(){this.client.stopClient()},getAvatarUrl:function(e){var t=this;return this.client.getProfileInfo(e,"avatar_url").then(function(e){return e.avatar_url?t.client.mxcUrlToHttp(e.avatar_url,100):null})},isGuest:function(){return this.client.isGuest()},joinRoom:function(e){return this.client.joinRoom(e)},leaveRoom:function(e){return this.client.leave(e)},sendEvent:function(e,t){return this.client.sendEvent(e,"org.rockdapus.audius",{type:"media",data:t})},redactEvent:function(e,t){return this.client.redactEvent(e,t)},sendMessage:function(e,t){return this.client.sendTextMessage(e,t)},setRoomAllowGuests:function(e,t){return this.client.sendStateEvent(e,"m.room.guest_access",{guest_access:t?"can_join":"forbidden"})},setRoomHistoryVisibility:function(e,t){if(["invited","joined","shared","world_readable"].includes(t))throw"setRoomHistoryVisibility unknown state "+t;return this.client.sendStateEvent(e,"m.room.history_visibility",{history_visibility:t})},setRoomName:function(e,t){return this.client.setRoomName(e,t)},setRoomVisibility:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.client.setRoomDirectoryVisibility(e,t?"private":"public")},createRoom:function(e){return this.client.createRoom(Object.assign(e,{initial_state:[{type:"m.room.guest_access",state_key:"",content:{guest_access:"can_join"}},{type:"m.room.history_visibility",state_key:"",content:{history_visibility:"world_readable"}}]}))},listPublicRooms:function(){return this.client.publicRooms({filter:{generic_search_term:"audius"}})},getCredentialsWithPassword:function(e,t){return new Promise(function(n){r.default.createClient("https://matrix.org").loginWithPassword(e,t).then(function(e){n({accessToken:e.access_token,userId:e.user_id,deviceId:e.device_id})})})},getCredentials:function(){return new Promise(function(e){r.default.createClient("https://matrix.org").registerGuest().then(function(t){e({accessToken:t.access_token,userId:t.user_id,deviceId:t.device_id})})})}};window.matrixClient=s}}]);