(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{144:function(e,t,s){"use strict";s.r(t);var a=s(480),n=s(208);for(var i in n)"default"!==i&&function(e){s.d(t,e,function(){return n[e]})}(i);s(339);var r=s(0),o=Object(r.a)(n.default,a.a,a.b,!1,null,null,null);o.options.__file="matrix-chat.vue",t.default=o.exports},208:function(e,t,s){"use strict";s.r(t);var a=s(209),n=s.n(a);for(var i in a)"default"!==i&&function(e){s.d(t,e,function(){return a[e]})}(i);t.default=n.a},209:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},n=u(s(4)),i=s(1),r=s(2),o=u(s(80)),c=u(s(336));function u(e){return e&&e.__esModule?e:{default:e}}var l=null,d=0,f=!1,h=0;t.default={components:{VideoItem:o.default,ChatMessage:c.default},data:function(){return{messageText:"",overflow:!1}},beforeUpdate:function(){var e=this.$refs.chat;f=e.scrollHeight-e.scrollTop-e.offsetHeight-100<0},mounted:function(){var e=this,t=this.chatLog[this.currentMediaSource.id]||[];l=t.length&&t[t.length-1].createdAt,d=this.$refs.chat.offsetHeight;var s=this.$refs.chat;n.default.nextTick(function(){e.$refs.chat.scrollTo(0,s.scrollHeight)}),this.$store.watch(function(e){return e.matrix.chatLog},function(){var t=e.chatLog[e.currentMediaSource.id];if(t){var a=t[t.length-1],i=a.createdAt,r=a.sender;l!==i?n.default.nextTick(function(){(f||r===e.credentials.userId)&&(s.scrollTo({behavior:"smooth",top:s.scrollHeight}),d=s.scrollHeight)}):n.default.nextTick(function(){var e=s.scrollHeight,t=e-d;s.scrollTop=t,setTimeout(function(){d=e},200)}),l=i}}),s.addEventListener("wheel",this.scrolled),s.addEventListener("scroll",this.scrolled)},computed:a({},(0,i.mapState)(["currentMediaSource","currentMedia","isPlaying","paginationIndex","isLoading"]),(0,r.mapModuleState)("matrix",["chatLog","credentials","membersIndex","sources"]),{_chatLog:function(){return(this.chatLog[this.currentMediaSource.id]||[]).filter(function(e){return!e.parentEvent})},_isLoading:function(){return this.isLoading[this.currentMediaSource.id]}}),methods:a({},(0,i.mapMutations)(["setMainLeftTab"]),(0,i.mapActions)(["matrixLoadMore","matrixSendText"]),{scrolled:function(e){this._isLoading&&e.preventDefault(),0===this.$refs.chat.scrollTop&&this.matrixLoadMore(this.currentMediaSource.id)},send:function(e){e.preventDefault(),this.messageText&&(this.matrixSendText({roomId:this.currentMediaSource.id,message:this.messageText.trim()}),this.messageText="",this.overflow=!1)},checkWidth:function(e){this.$refs.message.offsetHeight-this.$refs.message.scrollHeight<0?(this.overflow||(h=this.$refs.message.value.length),this.overflow=!0):this.$refs.message.value.length<h&&(this.overflow=!1,h=this.$refs.message.value.length)}})}},210:function(e,t,s){"use strict";s.r(t);var a=s(211),n=s.n(a);for(var i in a)"default"!==i&&function(e){s.d(t,e,function(){return a[e]})}(i);t.default=n.a},211:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},n=s(2),i=s(1);t.default={props:{video:Object,isAuthor:Boolean,isAdmin:Boolean,membersIndex:Object},methods:a({},(0,i.mapActions)(["matrixRedact"])),computed:{event:function(){return this.video},sender:function(){var e=this.event.sender;return this.membersIndex[e]||{name:e,nameColor:""}},_createdAt:function(){var e=new Date(this.event.createdAt);return e.getHours()+":"+(0,n.zeroPad)(e.getMinutes(),2)},messages:function(){for(var e=this.event,t=[e];e.childEvent;)e=e.childEvent,t.push(e);return t}}}},212:function(e,t,s){},213:function(e,t,s){},336:function(e,t,s){"use strict";s.r(t);var a=s(489),n=s(210);for(var i in n)"default"!==i&&function(e){s.d(t,e,function(){return n[e]})}(i);s(337);var r=s(0),o=Object(r.a)(n.default,a.a,a.b,!1,null,null,null);o.options.__file="matrix-chat-message.vue",t.default=o.exports},337:function(e,t,s){"use strict";var a=s(212);s.n(a).a},339:function(e,t,s){"use strict";var a=s(213);s.n(a).a},480:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"matrix-chat"},[s("div",{ref:"chat",staticClass:"play-list media-list"},[e._chatLog&&e._chatLog.length?e._e():s("div",{staticClass:"play-list__greeting"},[e._v("\n\t\t\tNothing found. Click load more or add from search or playlists.\n\t\t")]),e._v(" "),s("div",{staticClass:"play-list__load-more",on:{click:function(t){e.matrixLoadMore(e.currentMediaSource.id)}}},[e._v("\n\t\t\t… load more (Page "+e._s(e.paginationIndex[e.currentMediaSource.id]||0)+")\n\t\t\t"),s("div",{directives:[{name:"show",rawName:"v-show",value:e._isLoading,expression:"_isLoading"}],staticClass:"loader"})]),e._v(" "),s("ul",{ref:"list"},e._l(e._chatLog,function(t,a){return s("text"===t.type?"chat-message":"video-item",{key:a,tag:"component",attrs:{isAuthor:t.sender===e.credentials.userId,isAdmin:e.sources[e.currentMediaSource.id].isAdmin,video:t,membersIndex:e.membersIndex,isPlaying:"text"!==t.type&&e.isPlaying&&e.currentMedia.id==t.id}})}))]),e._v(" "),s("div",{staticClass:"matrix-chat__footer",class:{"matrix-chat--overflow":e.overflow}},[s("span",{staticClass:"wmp-icon-speaker_notes_off matrix-chat__off",on:{click:function(t){e.setMainLeftTab("playList")}}}),e._v(" "),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.messageText,expression:"messageText"}],ref:"message",attrs:{rows:"1",placeholder:"… your message"},domProps:{value:e.messageText},on:{keyup:[e.checkWidth,function(t){return"button"in t||!e._k(t.keyCode,"enter",13,t.key,"Enter")?e.send(t):null}],input:function(t){t.target.composing||(e.messageText=t.target.value)}}}),e._v(" "),s("span",{staticClass:"wmp-icon-send",on:{click:e.send}})])])},n=[];s.d(t,"a",function(){return a}),s.d(t,"b",function(){return n})},489:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("li",{staticClass:"matrix-chat-message",class:{"matrix-chat-message--author":e.isAuthor}},[s("div",{staticClass:"matrix-chat-message__container"},[s("div",{staticClass:"matrix-chat-message__header",style:{color:e.sender.nameColor}},[e._v("\n\t\t\t"+e._s(e.sender.name)+"\n\t\t")]),e._v(" "),s("div",{staticClass:"matrix-chat-message__body"},e._l(e.messages,function(t){return s("div",{class:{"matrix-chat-message--sending":"sending"===t.status}},[t.body?s("span",{domProps:{innerHTML:e._s(t.body)}}):e._e(),e._v(" "),t.url?s("div",{staticClass:"matrix-chat-message__image",style:{backgroundImage:"url("+t.url+")"}}):e._e(),e._v(" "),s("img"),e._v(" "),e.isAuthor||e.isAdmin?s("div",{staticClass:"wmp-icon-close matrix-chat-message__delete",attrs:{title:"Delete this message"},on:{click:function(s){e.matrixRedact(t)}}}):e._e()])})),e._v(" "),s("div",{staticClass:"matrix-chat-message__footer",class:{"matrix-chat-message--sending":"sending"===e.messages[e.messages.length-1].status}},[e._v(e._s(e._createdAt))])])])},n=[];s.d(t,"a",function(){return a}),s.d(t,"b",function(){return n})}}]);