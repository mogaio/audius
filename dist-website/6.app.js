webpackJsonp([6],{103:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(210);Object.defineProperty(t,"actions",{enumerable:!0,get:function(){return r.actions}});var n=o(306);Object.defineProperty(t,"mutations",{enumerable:!0,get:function(){return n.mutations}});var i=o(307);Object.defineProperty(t,"presistMutation",{enumerable:!0,get:function(){return i.presistMutation}});var a=o(16);Object.defineProperty(t,"state",{enumerable:!0,get:function(){return a.state}})},210:function(e,t,o){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}return Array.from(e)}function n(e,t,o,n,i){var a=e.sources[o];if(i.length){for(var s=[].concat(r(a.playList),r(i.filter(function(e){return e.id}).map(function(e){return Object.assign({},e,{roomId:o,eventId:n})}))),u=[].concat(r(a.archive));s.length>3e3;){var c=s.shift();u.push(c.id)}t("updateMatrixRoom",{roomId:o,values:{playList:s,archive:u}})}}Object.defineProperty(t,"__esModule",{value:!0}),t.actions=void 0;var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=o(4),s=o(11),u=void 0;t.actions={initMatrix:function(e){var t=e.commit,r=e.state,n=e.dispatch;o.e(17).then(o.bind(null,181)).then(function(e){u=e.matrixClient,r.matrix.hasCredentials?r.matrixLoggedIn||u.login(r.matrix.credentials,r.matrix.isGuest,n,t).then(function(e){t("setMatrixLoggedIn",{rooms:e}),n("updatePublicRooms")}):u.getCredentials().then(function(e){return t("setMatrixCredentials",{credentials:e,isGuest:!0})}).then(function(){return u.login(r.matrix.credentials,r.matrix.isGuest,n,t)}).then(function(e){t("setMatrixLoggedIn",{rooms:e}),n("updatePublicRooms")})})},loginMatrixWithPassword:function(e,t){var r=e.commit,n=e.state,i=e.dispatch,a=t.username,s=t.password;o.e(17).then(o.bind(null,181)).then(function(e){u=e.matrixClient,u.getCredentialsWithPassword(a,s).then(function(e){return r("setMatrixCredentials",{credentials:e,isGuest:!1})}).then(function(){return u.login(n.matrix.credentials,n.matrix.isGuest,i,r)}).then(function(e){return r("setMatrixLoggedIn",{rooms:e})}).catch(function(e){return r("error",""+e)})})},matrixSend:function(e,t){var o=e.state,r=e.commit,n=t.itemId,i=t.roomId,c=t.media,m=c||(0,s.getMediaEntity)(o,n);if(o.sources[i].playList.some(function(e){return e.id===m.id}))return void r("error","The media item was already posted.");o.sources[i].humanReadablePosts?u.sendMessage(i,(0,a.getMediaLink)(m)).catch(function(e){return r("error","Posting message to matrix room failed. "+e)}):u.sendEvent(i,m).catch(function(e){return r("error","Posting media to matrix room failed. "+e)})},matrixRedact:function(e,t){var o=e.state,r=e.commit;if(!t.roomId||!t.eventId)return void r("error","Not enough information to remove media from matrix room.");u.redactEvent(t.roomId,t.eventId).then(function(){r("updateMatrixRoom",{roomId:t.roomId,values:{playList:o.sources[t.roomId].playList.filter(function(e){return e.eventId!==t.eventId})}})}).catch(function(e){return r("error","Could not remove media from matrix room. "+e)})},matrixPaginate:function(e,t){var o=e.state,r=e.commit;u.paginate(o.currentMatrixRoom).then(function(e){e?r("setPaginationIndex",{id:t,index:(o.paginationIndex[t]||0)+1}):r("error","You reached the last page of this room.")}).catch(function(){return r("error","Paginating matrix room failed")})},joinMatrixRoom:function(e,t){var o=e.commit,r=t.id,n=t.name;u.joinRoom(r).then(function(e){e.name=n||r,o("setMatrixLoggedIn",{rooms:[e]}),o("selectMediaSource",{type:"webScraper",id:e.roomId}),o("setLeftMenuTab","webScraper")}).catch(function(e){console.log("err",e),"Guest access not allowed"===e.message&&o("toggleMatrixLoginModal",!0),o("error","Could not join room: "+e.message)})},createMatrixRoom:function(e,t){var o=e.commit;u.createRoom(t).then(function(e){e.name=t.name,e.roomId=e.room_id,o("setMatrixLoggedIn",{rooms:[e]}),o("updateMatrixRoom",{roomId:e.roomId,values:{isHidden:"private"===t.visibility}}),o("toggleMatrixRoomModal",!1),o("selectMediaSource",{type:"radio",id:e.room_id}),o("setLeftMenuTab","radio")}).catch(function(e){o("error","Could not create room. "+e)})},setRoomName:function(e,t){var o=e.commit,r=t.id,n=t.name;u.setRoomName(r,n).then(function(){return o("setMatrixLoggedIn",{rooms:[{roomId:r,name:n}]})}).catch(function(e){return o("error","Could not rename matrix room: "+e)})},setRoomTag:function(e,t){var o=e.commit,r=t.roomId,n=t.tagName;u.setRoomTag(r,n).then(function(){return o("error",{error:"room tag is set",type:"success"})}).catch(function(e){return o("error","Could not set tagName. "+e)})},updateRoomOptions:function(e,t){var o=e.commit;"humanReadablePosts"in t&&o("updateMatrixRoom",{roomId:t.id,values:{humanReadablePosts:t.humanReadablePosts}}),"allowGuests"in t&&u.setRoomAllowGuests(t.id,t.allowGuests).then(function(){return o("updateMatrixRoom",{roomId:t.id,values:{allowGuests:t.allowGuests}})}).catch(function(e){return o("error","Could not set allow guests to "+t.allowGuests+". "+e)}),"isHidden"in t&&u.setRoomVisibility(t.id,t.isHidden).then(function(){return o("updateMatrixRoom",{roomId:t.id,values:{isHidden:t.isHidden}})}).catch(function(e){return o("error","Could not set room private. "+e)})},leaveMatrixRoom:function(e,t){var o=e.commit;u.leaveRoom(t).then(function(){return o("deleteMatrixRoom",t)}).catch(function(){return o("error","Leaving matrix room failed")})},updatePublicRooms:function(e){var t=e.commit,o=new Set(["!hUkskxfIMmwAQuZIjz:matrix.org"]);u.listPublicRooms().then(function(e){var r=e.chunk.filter(function(e){var t=e.room_id;return!o.has(t)});t("setPublicRooms",r.map(function(e){return{name:e.name.replace("[Audius]",""),id:e.room_id,numberOfMembers:e.num_joined_members,topic:e.topic}}))}).catch(function(){return t("error","Getting public matrix Rooms failed")})},matrixLogout:function(e){var t=e.commit;u.logout(),t("matrixLogout")},parseMatrixMessage:function(e,t){var o=e.state,s=e.commit,u=t.roomId,c=t.eventId,m=t.message,d=o.sources[u];if(!(u in o.sources))return s("error","Could not find matrix room "+u),void s("updateMatrixRoom",{roomId:u});var l=new Set([].concat(r(d.playList.map(function(e){return e.id})),r(d.archive)));"object"===(void 0===m?"undefined":i(m))?(l.has(m.id)||n(o,s,u,c,[m]),window.console.log("[Matrix-Media] %c"+m.title,"color: #2DA7EF;")):(window.console.log("[Matrix-Text] %c"+m,"color: #2DA7EF;"),(0,a.findMediaText)(m,o.youtubeApiKey,{indexKnown:l}).then(function(e){var t=e.mediaList;n(o,s,u,c,t)}))}}},306:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){var o=[],r=!0,n=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(o.push(a.value),!t||o.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}return o}return function(t,o){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=function(){return JSON.parse(JSON.stringify({name:"",playList:[],playedMedia:{},archive:[]}))};t.mutations={setPublicRooms:function(e,t){e.matrix=Object.assign({},e.matrix,{publicRooms:t})},setMatrixCredentials:function(e,t){var o=t.credentials,r=t.isGuest;e.matrix.hasCredentials=!0,e.matrix.credentials=o,e.matrix.isGuest=r},setMatrixLoggedIn:function(e,t){var o=t.rooms;e.matrixLoggedIn=!0;var i=e.matrix.credentials.userId;if(o.forEach(function(t){var o=t.roomId;if(o in e.sources||(e.sources[o]=Object.assign({},n(),{name:t.name})),t.currentState){e.sources[o].members=Object.entries(t.currentState.members).map(function(e){var t=r(e,2);return{id:t[0],powerLevel:t[1].powerLevel}});var a=t.currentState.members[i]||{};e.sources[o].isAdmin=a.powerLevel>=100;try{e.sources[o].alias=t.currentState.events["m.room.aliases"]["matrix.org"].event.content.aliases[0]}catch(e){console.warn("could not get alias, well it is bad code anyway")}}e.sourcesOrdered.includes(o)||e.sourcesOrdered.unshift(o),e.sources[o].name===t.name||t.name.includes(":matrix.org")||(e.sources[o].name=t.name)}),o.length>1){var a=new Set(o.map(function(e){return e.roomId}));e.sourcesOrdered=e.sourcesOrdered.filter(function(e){return a.has(e)})}},toggleMatrixLoginModal:function(e,t){e.showMatrixLoginModal=void 0!==t?t:!e.showMatrixLoginModal},toggleMatrixRoomModal:function(e,t){e.createMatrixRoomModal=void 0!==t?t:!e.createMatrixRoomModal},toggleMatrixRoomDirectory:function(e,t){e.showMatrixRoomDirectory=void 0!==t?t:!e.showMatrixRoomDirectory},matrixRemoveAccount:function(e){e.matrix={hasCredentials:!1,credentials:{accessToken:"",userId:"",deviceId:""}}},matrixLogout:function(e){e.matrixLoggedIn=!1,e.sources={},e.sourcesOrdered=[],e.currentMatrixRoom=""},deleteMatrixRoom:function(e,t){e.sourcesOrdered=e.sourcesOrdered.filter(function(e){return e!==t})},updateMatrixRoom:function(e,t){var o=t.roomId,r=t.values;e.sources[o]||(e.sources[o]=Object.assign({},n(),{name:o})),e.sources[o]=Object.assign({},e.sources[o],r),e.sources=Object.assign({},e.sources)},setPaginationIndex:function(e,t){var o=t.id,r=t.index;e.paginationIndex[o]=r,e.paginationIndex=Object.assign({},e.paginationIndex)}}},307:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.presistMutation={setMatrixCredentials:["matrix"],setPublicRooms:["matrix"],setMatrixEnabled:["matrixEnabled"],updateMatrixRoom:["sources"],matrixRemoveAccount:["matrix"],deleteMatrixRoom:["sourcesOrdered"]}}});