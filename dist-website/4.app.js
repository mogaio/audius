(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{367:function(e,r,t){"use strict";t.r(r);var n=t(1);function i(e){return function(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function a(e){window.dispatchEvent(new CustomEvent("audiusExtension",{detail:e}))}var s={renameWebScraper:function(e,r){var t=e.state,n=e.commit,i=r.oldName,a=r.newName;t.sources[a]||(n("renameWebScraper",{oldName:i,newName:a}),n("selectMediaSource",{type:"webScraper",id:a}))},webScraperUpdateSuccess:function(e,r){var t=e.state,a=e.rootState,s=e.commit,o=e.dispatch,c=r.id,u=r.mediaList;s("toggleIsLoading",{id:c,loading:!1}),u?Object(n.e)("",a.youtubeApiKey,a.mediaIndex,{mediaList:u}).then(function(e){var r=e.newMedia,n=e.mediaList;r.length&&s("updateMediaIndex",r);var u=t.sources[c],d=u?u.playList:[],l=u&&u.archive?u.archive:[],p=new Set(i(d.map(function(e){return e.id})).concat(i(l))),g=Object.values(n.reduce(function(e,r){return p.has(r.id)||r.id in e||(e[r.id]=r),e},{}));if(g.length){s("updateMediaIndex",g);for(var f=i(d).concat(i(g));f.length>3e3;){var m=f.shift();l.push(m.id)}g.length&&s("updateWebScraper",{id:c,values:{playList:f,archive:l}}),a.matrix.matrixLoggedIn&&t.forward[c]&&t.forward[c].forEach(function(e){n.forEach(function(r){o("matrixSend",{roomId:e.id,media:r,silent:!0})})})}else s("error","No new videos found for ".concat(c,". Try agin."))}):s("error","Requesting ".concat(c," did not return results."))},initWebScraper:function(e,r){var t=e.state,n=e.commit,i=e.dispatch;!r||r in t.sources||n("addWebScraper",r),t.sources[r].playList.length||i("webScraperLoadMore",r)},webScraperLoadMore:function(e,r){var t=e.state,i=e.commit,s=e.dispatch,o=e.rootState;if(r){if(!o.isLoading[r]){i("toggleIsLoading",{id:r,loading:!0}),setTimeout(function(){i("toggleIsLoading",{id:r,loading:!1})},1e4);var c=t.sources[r],u=o.paginationIndex[r]||0;if("Imgur"===r)i("toggleIsLoading",{id:r,loading:!0}),i("increasePaginationIndex",r),n.w.getImgurMedia(o.paginationIndex[r]).then(function(e){s("webScraperUpdateSuccess",{id:r,mediaList:e})}).catch(function(e){return i("error","Could not get Imgur. ".concat(e))}).finally(function(){return i("toggleIsLoading",{id:r,loading:!1})});else if("watch"===c.settings.type)i("toggleIsLoading",{id:r,loading:!1});else if("script"===c.settings.type)i("increasePaginationIndex",r),t.sourcesInitialized[r]?a({audius:!0,type:"getNext",id:r}):a({audius:!0,type:"loadScript",id:r,code:c.settings.script,youtubeApiKey:o.youtubeApiKey,responseTemplate:{audius:!0,vuex:"commit",type:"initScraperSuccess",data:r}});else if("urls"===c.settings.type){var d=u;if(u>=c.settings.numPages-1)i("error","Checked all URLs in channel, try again next time.");else if(c.settings.urls){var l,p=0;if(c.settings.urls.every(function(e){return(p+=e.numPages)>u?(l=e.url,!1):(d-=e.numPages,!0)}),!o.extensionAvilable)return i("error","The audius extension is not installed. Please install it."),void i("setShowSettings");i("increasePaginationIndex",r),a({audius:!0,type:"scanUrl",url:n.w.patternToUrls(l)[d],youtubeApiKey:o.youtubeApiKey,responseTemplate:{audius:!0,vuex:"dispatch",type:"webScraperUpdateSuccess",data:{id:r}}})}else i("error","Channel URLs missing")}}}else i("error",'Can not find channel "'.concat(r,'".'))}};function o(e){return function(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c={recoverState_webScraper:function(e,r){Object.assign(e,r)},addWebScraper:function(e,r){if(!r){var t=1;for(r="Channel ".concat(t);r in e.sources;)r="Channel ".concat(t++)}e.sources[r]={playList:[],settings:{},archive:[]},e.sourcesOrdered.includes(r)||e.sourcesOrdered.push(r),e.currentWebScraper=r},deleteWebScraper:function(e,r){delete e.sources[r],e.sourcesOrdered=e.sourcesOrdered.filter(function(e){return e!==r})},initScraperSuccess:function(e,r){e.sourcesInitialized[r]=!0},addUrlPattern:function(e,r){var t=r.id,i=r.urlPattern,a=e.sources[t].settings.urls||[],s=e.sources[t].settings;a.some(function(e){return e===i})||(s.urls=o(a).concat([{url:i,numPages:n.w.patternToUrls(i).length}]),s.numPages=s.urls.reduce(function(e,r){return e+r.numPages},0)),e.sources=Object.assign({},e.sources)},updateWebScraper:function(e,r){var t=r.id,n=r.values;e.sources[t]=Object.assign({},e.sources[t],n),e.sources=Object.assign({},e.sources)},renameWebScraper:function(e,r){var t=r.newName,n=r.oldName,i=Object.assign({},e.sources);i[t]=i[n];var a=o(e.sourcesOrdered);a[a.indexOf(n)]=t,delete i[n],e.sources=i,e.sourcesOrdered=a},editWebScraperForward:function(e,r){var t=r.id,n=r.forward;e.forward[t]=n,e.forward=Object.assign({},e.forward)}},u=t(10),d=t(27);t.d(r,"actions",function(){return s}),t.d(r,"mutations",function(){return c}),t.d(r,"presistMutation",function(){return u.a}),t.d(r,"state",function(){return d.a})}}]);