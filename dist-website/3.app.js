(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{141:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o(316);Object.defineProperty(t,"actions",{enumerable:!0,get:function(){return r.actions}});var n=o(317);Object.defineProperty(t,"mutations",{enumerable:!0,get:function(){return n.mutations}});var i=o(81);Object.defineProperty(t,"presistMutation",{enumerable:!0,get:function(){return i.presistMutation}});var a=o(84);Object.defineProperty(t,"state",{enumerable:!0,get:function(){return a.state}})},316:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.actions=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=o(2),i=o(48);function a(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}return Array.from(e)}var s=void 0;function u(e,t,o,r,n){var i=e.sources[o];if(n.length){for(var s=[].concat(a(i.playList),a(n.filter(function(e){return e.id}).map(function(e){return Object.assign({},e,{roomId:o,eventId:r})}))),u=[].concat(a(i.archive));s.length>3e3;){var c=s.shift();u.push(c.id)}t("updateMatrixRoom",{roomId:o,values:{playList:s,archive:u}})}}var c=/(https?:\/\/[^\s]+)/g;t.actions={initMatrix:function(e){var t=e.commit,r=e.state,n=e.dispatch;Promise.all([o.e(1),o.e(0)]).then(o.t.bind(null,260,7)).then(function(e){s=e.matrixClient,r.hasCredentials?r.matrixLoggedIn||s.login(r.credentials,r.isGuest,n,t).then(function(e){t("setMatrixLoggedIn",{rooms:e})}).catch(function(e){return t("error",e+"2")}):s.getCredentials().then(function(e){return t("setMatrixCredentials",{credentials:e,isGuest:!0})}).then(function(){return s.login(r.credentials,r.isGuest,n,t)}).then(function(e){t("setMatrixLoggedIn",{rooms:e}),n("updatePublicRooms")}).catch(function(e){return t("error",e+"1")})})},loginMatrixWithPassword:function(e,t){var r=e.commit,n=e.state,i=e.dispatch,a=t.username,u=t.password;Promise.all([o.e(1),o.e(0)]).then(o.t.bind(null,260,7)).then(function(e){(s=e.matrixClient).getCredentialsWithPassword(a,u).then(function(e){return r("setMatrixCredentials",{credentials:e,isGuest:!1})}).then(function(){return s.login(n.credentials,n.isGuest,i,r)}).then(function(e){return r("setMatrixLoggedIn",{rooms:e})}).catch(function(e){return r("error",e+"3")})})},registerMatrixUser:function(e,t){var r=e.state,n=e.commit,i=e.dispatch;Object.assign({sessionId:"",auth:void 0,bindThreepids:{email:!0},guestAccessToken:void 0},t),Promise.all([o.e(1),o.e(0)]).then(o.t.bind(null,260,7)).then(function(e){(s=e.matrixClient).register(t).then(function(e){return console.log("event",e),e}).then(function(e){return n("setMatrixCredentials",{credentials:e,isGuest:!1})}).then(function(){return s.login(r.credentials,r.isGuest,i,n)}).catch(function(e){return n("error","Register: "+e)})})},matrixSend:function(e,t){var o=e.state,r=e.rootState,a=e.commit,u=t.itemId,c=t.roomId,d=t.media||(0,i.getMediaEntity)(r,u);o.sources[c].playList.some(function(e){return e.id===d.id})?a("error","The media item was already posted."):o.sources[c].humanReadablePosts?s.sendMessage(c,(0,n.getMediaLink)(d)).catch(function(e){return a("error","Posting message to matrix room failed. "+e)}):s.sendEvent(c,d).catch(function(e){return a("error","Posting media to matrix room failed. "+e)})},matrixRedact:function(e,t){var o=e.state,r=e.commit;t.roomId&&t.eventId?s.redactEvent(t.roomId,t.eventId).then(function(){r("updateMatrixRoom",{roomId:t.roomId,values:{playList:o.sources[t.roomId].playList.filter(function(e){return e.eventId!==t.eventId})}})}).catch(function(e){return r("error","Could not remove media from matrix room. "+e)}):r("error","Not enough information to remove media from matrix room.")},matrixPaginate:function(e,t){e.state;var o=e.commit,r=e.rootState;s.paginate(r.currentMediaSource.id).then(function(e){e?o("setPaginationIndex",{id:t,index:(r.paginationIndex[t]||0)+1}):o("error","You reached the last page of this room.")}).catch(function(){return o("error","Paginating matrix room failed")})},joinMatrixRoom:function(e,t){var o=e.commit,r=t.id,n=t.name;o("toggleMatrixRoomDirectory",!1),s.joinRoom(r).then(function(e){e.name=n||r,o("joinRoom",e),o("selectMediaSource",{type:"matrix",id:e.roomId}),o("setLeftMenuTab","matrix")}).catch(function(e){console.log("err",e),"Guest access not allowed"===e.message&&o("toggleMatrixLoginModal",!0),"M_CONSENT_NOT_GIVEN"===e.errcode?(o("setLeftMenuTab","matrix"),o("toggleMatrixConsentModal",{toggleState:!0,message:function(e){return e.replace(c,'<a href="$1" target="_blank">$1</a>')}(e.message.replace(/\.$/,""))})):o("error","Could not join room: "+e.message)})},createMatrixRoom:function(e,t){var o=e.commit;s.createRoom(t).then(function(e){e.name=t.name,e.roomId=e.room_id,o("setMatrixLoggedIn",{rooms:[e]}),o("updateMatrixRoom",{roomId:e.roomId,values:{isHidden:"private"===t.visibility}}),o("toggleMatrixRoomModal",!1),o("selectMediaSource",{type:"matrix",id:e.room_id}),o("setLeftMenuTab","radio")}).catch(function(e){o("error","Could not create room. "+e)})},setRoomName:function(e,t){var o=e.commit,r=t.id,n=t.name;s.setRoomName(r,n).then(function(){return o("updateMatrixRoom",{roomId:r,values:{name:n}})}).catch(function(e){return o("error","Could not rename matrix room: "+e)})},setRoomTag:function(e,t){var o=e.commit,r=t.roomId,n=t.tagName;s.setRoomTag(r,n).then(function(){return o("error",{error:"room tag is set",type:"success"})}).catch(function(e){return o("error","Could not set tagName. "+e)})},updateRoomOptions:function(e,t){var o=e.commit;"humanReadablePosts"in t&&o("updateMatrixRoom",{roomId:t.id,values:{humanReadablePosts:t.humanReadablePosts}}),"allowGuests"in t&&s.setRoomAllowGuests(t.id,t.allowGuests).then(function(){return o("updateMatrixRoom",{roomId:t.id,values:{allowGuests:t.allowGuests}})}).catch(function(e){return o("error","Could not set allow guests to "+t.allowGuests+". "+e)}),"isHidden"in t&&s.setRoomVisibility(t.id,t.isHidden).then(function(){return o("updateMatrixRoom",{roomId:t.id,values:{isHidden:t.isHidden}})}).catch(function(e){return o("error","Could not set room private. "+e)})},leaveMatrixRoom:function(e,t){var o=e.commit;s.leaveRoom(t).then(function(){return o("deleteMatrixRoom",t)}).catch(function(){return o("error","Leaving matrix room failed")})},updatePublicRooms:function(e){var t=e.commit,o=new Set(["!hUkskxfIMmwAQuZIjz:matrix.org"]);s.listPublicRooms().then(function(e){var r=e.chunk.filter(function(e){var t=e.room_id;return!o.has(t)});t("setPublicRooms",r.map(function(e){return{name:e.name.replace("[Audius]",""),id:e.room_id,numberOfMembers:e.num_joined_members,topic:e.topic}}))}).catch(function(e){return t("error","Getting public matrix Rooms failed. "+e)})},matrixLogout:function(e){var t=e.commit;s.logout(),t("matrixLogout")},parseMatrixMessage:function(e,t){var o=e.state,i=e.commit,s=e.rootState,c=t.roomId,d=t.eventId,m=t.message,l=o.sources[c];if(!(c in o.sources))return i("error","Could not find matrix room "+c),void i("updateMatrixRoom",{roomId:c});var f=new Set([].concat(a(l.playList.map(function(e){return e.id})),a(l.archive)));"object"===(void 0===m?"undefined":r(m))?(f.has(m.id)||u(o,i,c,d,[m]),window.console.log("[Matrix-Media] %c"+m.title,"color: #2DA7EF;")):(window.console.log("[Matrix-Text] %c"+m,"color: #2DA7EF;"),(0,n.findMediaText)(m,s.youtubeApiKey,{indexKnown:f}).then(function(e){var t=e.mediaList;u(o,i,c,d,t)}))}}},317:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var o=[],r=!0,n=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(o.push(a.value),!t||o.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw i}}return o}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function n(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}return Array.from(e)}var i=function(){return JSON.parse(JSON.stringify({name:"",playList:[],playedMedia:{},archive:[],members:0}))};t.mutations={recoverState_matrix:function(e,t){Object.assign(e,t)},setPublicRooms:function(e,t){e.publicRooms=t},setMatrixCredentials:function(e,t){var o=t.credentials,r=t.isGuest;e.hasCredentials=!0,e.credentials=o,e.isGuest=r},joinRoom:function(e,t){var o=t.roomId;o in e.sources||(e.sources[o]=Object.assign({},i(),{name:t.name}),e.sourcesOrdered=[].concat(n(e.sourcesOrdered),[o]))},setMatrixLoggedIn:function(e,t){var o=t.rooms;e.showMatrixLoginModal=!1,e.matrixLoggedIn=!0;var a=e.credentials.userId;if(o.forEach(function(t){var o=t.roomId;if(o in e.sources||(e.sources[o]=Object.assign({},i(),{name:t.name})),t.currentState){console.log("room.currentState",t.currentState),e.sources[o].members=Object.entries(t.currentState.members).map(function(e){var t=r(e,2);return{id:t[0],powerLevel:t[1].powerLevel}});var n=t.currentState.members[a]||{};e.sources[o].isAdmin=n.powerLevel>=100;try{var s=r(t.currentState.events["m.room.aliases"]["matrix.org"].event.content.aliases,1);e.sources[o].alias=s[0]}catch(e){console.warn("could not get alias, well it is bad code anyway")}}e.sourcesOrdered.includes(o)||e.sourcesOrdered.unshift(o),e.sources[o].name===t.name||t.name.includes(":matrix.org")||(e.sources[o].name=t.name)}),o.length>=1){var s=new Set(o.map(function(e){return e.roomId}));e.sourcesOrdered=[].concat(n(e.sourcesOrdered.filter(function(e){return s.has(e)})),n(o.filter(function(t){var o=t.roomId;return!e.sourcesOrdered.includes(o)})))}},toggleMatrixLoginModal:function(e,t){e.showMatrixLoginModal=void 0!==t?t:!e.showMatrixLoginModal},toggleMatrixRoomModal:function(e,t){e.createMatrixRoomModal=void 0!==t?t:!e.createMatrixRoomModal},toggleMatrixConsentModal:function(e,t){if("boolean"!=typeof t){var o=t.toggleState,r=t.message;r&&(e.matrixConsentMessage=r),e.showMatrixConsentModal=void 0!==o?o:!e.showMatrixConsentModal}else e.showMatrixConsentModal=t},toggleMatrixRoomDirectory:function(e,t){e.showMatrixRoomDirectory=void 0!==t?t:!e.showMatrixRoomDirectory},matrixRemoveAccount:function(e){Object.assign(e,{hasCredentials:!1,matrixLoggedIn:!1,isGuest:null,credentials:{accessToken:"",userId:"",deviceId:""}})},matrixLogout:function(e){e.matrixLoggedIn=!1,e.currentMatrixRoom=""},deleteMatrixRoom:function(e,t){e.sourcesOrdered=e.sourcesOrdered.filter(function(e){return e!==t}),delete e.sources[t]},toggleHideRoom:function(e,t){Object.assign(e.sources[t],{hidden:!e.sources[t].hidden}),e.sources=Object.assign({},e.sources)},updateMatrixRoom:function(e,t){var o=t.roomId,r=t.values;e.sources[o]||(e.sources[o]=Object.assign({},i(),{name:o})),e.sources[o]=Object.assign({},e.sources[o],r),e.sources=Object.assign({},e.sources)}}}}]);